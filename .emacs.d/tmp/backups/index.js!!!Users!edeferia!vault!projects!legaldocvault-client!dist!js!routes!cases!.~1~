define(function(require) {
  'use strict';

  var Route = require('js/utils/route');
  var api = require('js/utils/api');

  return new Route({

    initialize: function(caseId) {
      return api.get('/cases/' + caseId + '/pleadings')
        .bind(this)
        .then(function(data) {
          return this.loadDashboard(data.client)
            .then(_.partial(this.loadCase, data));
        });
    },

    loadCase: function(data) {
      var modelData = {
        vaultCase: data.vaultCase,
        pleadings: data.pleadings
      };

      return this.loadModel('cases/model.js', modelData)
        .then(function(modelInstance) {
          var viewData = {model: modelInstance};
          return this.loadView('cases/view.js', viewData);
        })
        .then(function(viewInstance) {
          viewInstance.render();
        });
    },

    loadDashboard: function(vaultCase) {
      return this.loadModel('dashboard/model.js')
        .then(function(modelInstance) {
          var viewData = {model: modelInstance};
          return this.loadView('dashboard/view.js', viewData);
        })
        .then(function(viewInstance) {
          viewInstance.render('cases', 'pleadings', {vaultCase: vaultCase});
        });
    }

  });

});
