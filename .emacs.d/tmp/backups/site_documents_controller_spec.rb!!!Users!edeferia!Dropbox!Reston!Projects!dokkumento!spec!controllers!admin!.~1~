require 'spec_helper'


describe Admin::SiteDocumentsController do
 include ControllerMacros

 before :all do
   signup_user
 end

 def valid_attributes
   {
     :title => "A site-wide document",
     :description => "A site-wide document description",
     :file => fixture_file_upload("#{Rails.root}/spec/fixtures/files/testfile.pdf", 'application/pdf'),
     :document_type => "Guide",
     :purpose => "Email"
   }
 end

 describe "POST create" do
   login_user

   it "creates a new Site Document" do

      expect {
       post :create, {:site_document => valid_attributes, :organization => @user.member.organization }
      }.to change(SiteDocument, :count).by(1)

   end

   it "posting of duplicate (based on purpose) document does not increment the collection" do
      expect {
       _attributes = valid_attributes.merge({:purpose => 'a dup purpose'})
       post :create, {:site_document => _attributes, :organization => @user.member.organization }
       _attributes = valid_attributes.merge({:purpose => 'a dup purpose'})
       post :create, {:site_document => _attributes, :organization => @user.member.organization }

      }.to change(SiteDocument, :count).by(1)
   end

 end


 describe "GET index" do
   login_user

   it "retrives a list of Site Documents" do
     get :index
     expect(response).to render_template :index
   end
 end


end
