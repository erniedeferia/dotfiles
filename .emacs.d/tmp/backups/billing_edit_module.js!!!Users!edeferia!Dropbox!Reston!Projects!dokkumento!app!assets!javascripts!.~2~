modulejs.define("billing_edit_module", ['jquery', 'knockout', 'billing_entry_module'],
  function($,ko,b) {

   editableBillingEntry = $.extend({}, (new b.billingEntryModel()), {});

   editableBillingEntryViewModel = $.extend({}, (new b.billingEntryViewModel()), {
      billing_list: ko.mapping.fromJS([]),
      load: function() {
        self = this;
        var url = '/organizations/'+$organizationID+'/billing_entries/list.json';
        return $.getJSON(url)
          .done(function(data) {
            ko.mapping.fromJS(data, {}, self.billing_list);
         });
      },

      removeEntry: function(entry) {
          self.billing_list.remove(entry);
          var url= '/organizations/'+$organizationID+'/billing_entries/'+entry.id()+'.json';
          return $.ajax({
            type: 'DELETE',
            dataType: "json",
            url: url
          });
       },

       editEntry: function(entry) {
           var url = '/organizations/' + $organizationID + '/billing_entries/' + entry.id();
           Turbolinks.visit(url);
       }

   });


  return {
     EditableBillingEntry: editableBillingEntry,
     EditableBillingEntryViewModel: editableBillingEntryViewModel
  };

});

$(document).ready( function() {

  if( alexandria_cloud.shouldExecuteModuleFn("billing_entries_edit")) {
      var bedit = modulejs.require('billing_edit_module');

      var vm = bedit.EditableBillingEntryViewModel;
      vm.load().done( function() {
        ko.applyBindings(vm);
      });

  }
});
